<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>ariadne.util API documentation</title>
<meta name="description" content="æœ¬æ¨¡å—æä¾› Ariadne å†…éƒ¨ä½¿ç”¨çš„å°å·¥å…·, ä»¥åŠæ–¹ä¾¿çš„ `async_exec` æ¨¡å—." />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}#lunr-search{width:100%;font-size:1em;padding:6px 9px 5px 9px;border:1px solid silver}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>ariadne.util</code></h1>
</header>
<section id="section-intro">
<p>æœ¬æ¨¡å—æä¾› Ariadne å†…éƒ¨ä½¿ç”¨çš„å°å·¥å…·, ä»¥åŠæ–¹ä¾¿çš„ <code><a title="ariadne.util.async_exec" href="async_exec.html">ariadne.util.async_exec</a></code> æ¨¡å—.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;æœ¬æ¨¡å—æä¾› Ariadne å†…éƒ¨ä½¿ç”¨çš„å°å·¥å…·, ä»¥åŠæ–¹ä¾¿çš„ `async_exec` æ¨¡å—.
&#34;&#34;&#34;

# Utility Layout
import asyncio
import functools
import sys
import traceback
import warnings
from asyncio.events import AbstractEventLoop
from typing import (
    AsyncIterator,
    Callable,
    ContextManager,
    Coroutine,
    Dict,
    Generator,
    List,
    Type,
    TypeVar,
    Union,
)

from graia.broadcast import Broadcast
from graia.broadcast.entities.decorator import Decorator
from graia.broadcast.entities.dispatcher import BaseDispatcher
from graia.broadcast.entities.event import Dispatchable
from graia.broadcast.entities.listener import Listener
from graia.broadcast.entities.namespace import Namespace
from graia.broadcast.interfaces.dispatcher import DispatcherInterface
from graia.broadcast.typing import T_Dispatcher
from loguru import logger
from prompt_toolkit.patch_stdout import StdoutProxy
from typing_extensions import ParamSpec

from ..context import enter_context

# Import layout
from . import async_exec
from .async_exec import ParallelExecutor, cpu_bound, io_bound

P = ParamSpec(&#34;P&#34;)
R = TypeVar(&#34;R&#34;)

from ..exception import (
    AccountMuted,
    AccountNotFound,
    InvalidArgument,
    InvalidSession,
    InvalidVerifyKey,
    MessageTooLong,
    UnknownError,
    UnknownTarget,
    UnVerifiedSession,
)

code_exceptions_mapping: Dict[int, Type[Exception]] = {
    1: InvalidVerifyKey,
    2: AccountNotFound,
    3: InvalidSession,
    4: UnVerifiedSession,
    5: UnknownTarget,
    6: FileNotFoundError,
    10: PermissionError,
    20: AccountMuted,
    30: MessageTooLong,
    400: InvalidArgument,
}


def validate_response(code: Union[dict, int]):
    origin = code
    if isinstance(code, dict):
        code = code.get(&#34;code&#34;)
    else:
        code = code
    if not isinstance(code, int) or code == 200 or code == 0:
        return
    exc_cls = code_exceptions_mapping.get(code)
    if exc_cls:
        raise exc_cls(exc_cls.__doc__)
    else:
        raise UnknownError(f&#34;{origin}&#34;)


def loguru_excepthook(cls, val, tb, *_, **__):
    logger.opt(exception=(cls, val, tb)).error(f&#34;Exception:&#34;)


def loguru_async_handler(loop: AbstractEventLoop, ctx: dict):
    if &#34;exception&#34; in ctx:
        logger.opt(exception=ctx[&#34;exception&#34;]).error(&#34;Exception:&#34;)
    else:
        logger.error(f&#34;Exception: {ctx}&#34;)


def inject_loguru_traceback(loop: AbstractEventLoop):
    &#34;&#34;&#34;ä½¿ç”¨ loguru æ¨¡å—æ›¿æ¢é»˜è®¤çš„ traceback.print_exception ä¸ sys.excepthook&#34;&#34;&#34;
    traceback.print_exception = loguru_excepthook
    sys.excepthook = loguru_excepthook
    loop.set_exception_handler(loguru_async_handler)


def inject_bypass_listener(broadcast: Broadcast):
    &#34;&#34;&#34;æ³¨å…¥ BypassListener ä»¥äº«å—å­äº‹ä»¶è§£æ.

    Args:
        broadcast (Broadcast): å¤–éƒ¨äº‹ä»¶ç³»ç»Ÿ, æä¾›äº† event_class_generator æ–¹æ³•ä»¥ç”Ÿæˆå­äº‹ä»¶.
    &#34;&#34;&#34;

    class BypassListener(Listener):
        def __init__(
            self,
            callable: Callable,
            namespace: Namespace,
            listening_events: List[Type[Dispatchable]],
            inline_dispatchers: List[T_Dispatcher] = None,
            decorators: List[Decorator] = None,
            priority: int = 16,
        ) -&gt; None:
            events = []
            for event in listening_events:
                events.append(event)
                events.extend(broadcast.event_class_generator(event))
            super().__init__(
                callable,
                namespace,
                events,
                inline_dispatchers=inline_dispatchers,
                decorators=decorators,
                priority=priority,
            )

    @broadcast.dispatcher_interface.inject_global_raw
    async def _(interface: DispatcherInterface):
        if isinstance(interface.event, interface.annotation):
            return interface.event
        elif (
            hasattr(interface.annotation, &#34;__origin__&#34;)
            and interface.annotation.__origin__ is DispatcherInterface
        ):
            return interface

    import graia.broadcast.entities.listener

    graia.broadcast.entities.listener.Listener = BypassListener  # type: ignore
    graia.broadcast.Listener = BypassListener  # type: ignore
    try:  # Override saya listener
        import graia.saya.builtins.broadcast.schema

        graia.saya.builtins.broadcast.schema.Listener = BypassListener  # type: ignore
    except ImportError:  # Saya not installed, pass.
        pass


class ApplicationMiddlewareDispatcher(BaseDispatcher):
    always = True
    context: ContextManager

    def __init__(self, app) -&gt; None:
        self.app = app

    def beforeExecution(self, interface: &#34;DispatcherInterface&#34;):
        self.context = enter_context(self.app, interface.event)
        self.context.__enter__()

    def afterExecution(self, interface: &#34;DispatcherInterface&#34;, exception, tb):
        self.context.__exit__(exception.__class__ if exception else None, exception, tb)

    async def catch(self, interface: &#34;DispatcherInterface&#34;):
        from ..app import Ariadne

        if interface.annotation is Ariadne:
            return self.app


def app_ctx_manager(func: Callable[P, R]) -&gt; Callable[P, R]:
    @functools.wraps(func)
    async def wrapper(self, *args: P.args, **kwargs: P.kwargs):
        with enter_context(app=self):
            return await func(self, *args, **kwargs)

    return wrapper


T = TypeVar(&#34;T&#34;)


def gen_subclass(cls: Type[T]) -&gt; Generator[Type[T], None, None]:
    yield cls
    for sub_cls in cls.__subclasses__():
        yield from gen_subclass(sub_cls)


def wrap_bracket(string: str) -&gt; str:
    return string.replace(&#34;[&#34;, &#34;\\u005b&#34;).replace(&#34;]&#34;, &#34;\\u005d&#34;)


T_Callable = TypeVar(&#34;T_Callable&#34;, bound=Callable)


async def await_predicate(predicate: Callable[[], bool], interval: float = 0.01) -&gt; None:
    while not predicate():
        await asyncio.sleep(interval)


async def yield_with_timeout(
    getter_coro: Callable[[], Coroutine[None, None, T]],
    predicate: Callable[[], bool],
    await_length: float = 0.2,
) -&gt; AsyncIterator[T]:
    last_tsk = None
    while predicate():
        last_tsk = last_tsk or {asyncio.create_task(getter_coro())}
        done, last_tsk = await asyncio.wait(last_tsk, timeout=await_length)
        if not done:
            continue
        for t in done:
            res = await t
            yield res


def deprecated(remove_ver: str) -&gt; Callable[[T_Callable], T_Callable]:
    def out_wrapper(func: T_Callable) -&gt; T_Callable:
        @functools.wraps(func)
        def wrapper(*args, **kwargs):
            warnings.warn(DeprecationWarning(f&#34;{func.__qualname__} will be removed in {remove_ver}!&#34;))
            logger.warning(f&#34;Deprecated function: {func.__qualname__}&#34;)
            logger.warning(f&#34;{func.__qualname__} will be removed in {remove_ver}!&#34;)
            return func(*args, **kwargs)

        return wrapper

    return out_wrapper


def cast_to(obj, typ: Type[T]) -&gt; T:
    if typ:
        return obj</code></pre>
</details>
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="ariadne.util.async_exec" href="async_exec.html">ariadne.util.async_exec</a></code></dt>
<dd>
<div class="desc"><p>æœ¬æ¨¡å—æä¾›å¹¶è¡Œæ‰§è¡Œå™¨, åŠæ–¹ä¾¿å‡½æ•° <code>io_bound</code>, <code>cpu_bound</code>.</p></div>
</dd>
</dl>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="ariadne.util.app_ctx_manager"><code class="name flex">
<span>def <span class="ident">app_ctx_manager</span></span>(<span>func:Â Callable[[~P],Â ~R]) â€‘>Â Callable[[~P],Â ~R]</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def app_ctx_manager(func: Callable[P, R]) -&gt; Callable[P, R]:
    @functools.wraps(func)
    async def wrapper(self, *args: P.args, **kwargs: P.kwargs):
        with enter_context(app=self):
            return await func(self, *args, **kwargs)

    return wrapper</code></pre>
</details>
</dd>
<dt id="ariadne.util.await_predicate"><code class="name flex">
<span>async def <span class="ident">await_predicate</span></span>(<span>predicate:Â Callable[[],Â bool], interval:Â floatÂ =Â 0.01) â€‘>Â None</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">async def await_predicate(predicate: Callable[[], bool], interval: float = 0.01) -&gt; None:
    while not predicate():
        await asyncio.sleep(interval)</code></pre>
</details>
</dd>
<dt id="ariadne.util.cast_to"><code class="name flex">
<span>def <span class="ident">cast_to</span></span>(<span>obj, typ:Â Type[~T]) â€‘>Â ~T</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def cast_to(obj, typ: Type[T]) -&gt; T:
    if typ:
        return obj</code></pre>
</details>
</dd>
<dt id="ariadne.util.deprecated"><code class="name flex">
<span>def <span class="ident">deprecated</span></span>(<span>remove_ver:Â str) â€‘>Â Callable[[~T_Callable],Â ~T_Callable]</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def deprecated(remove_ver: str) -&gt; Callable[[T_Callable], T_Callable]:
    def out_wrapper(func: T_Callable) -&gt; T_Callable:
        @functools.wraps(func)
        def wrapper(*args, **kwargs):
            warnings.warn(DeprecationWarning(f&#34;{func.__qualname__} will be removed in {remove_ver}!&#34;))
            logger.warning(f&#34;Deprecated function: {func.__qualname__}&#34;)
            logger.warning(f&#34;{func.__qualname__} will be removed in {remove_ver}!&#34;)
            return func(*args, **kwargs)

        return wrapper

    return out_wrapper</code></pre>
</details>
</dd>
<dt id="ariadne.util.gen_subclass"><code class="name flex">
<span>def <span class="ident">gen_subclass</span></span>(<span>cls:Â Type[~T]) â€‘>Â Generator[Type[~T],Â None,Â None]</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def gen_subclass(cls: Type[T]) -&gt; Generator[Type[T], None, None]:
    yield cls
    for sub_cls in cls.__subclasses__():
        yield from gen_subclass(sub_cls)</code></pre>
</details>
</dd>
<dt id="ariadne.util.inject_bypass_listener"><code class="name flex">
<span>def <span class="ident">inject_bypass_listener</span></span>(<span>broadcast:Â graia.broadcast.Broadcast)</span>
</code></dt>
<dd>
<div class="desc"><p>æ³¨å…¥ BypassListener ä»¥äº«å—å­äº‹ä»¶è§£æ.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>broadcast</code></strong> :&ensp;<code>Broadcast</code></dt>
<dd>å¤–éƒ¨äº‹ä»¶ç³»ç»Ÿ, æä¾›äº† event_class_generator æ–¹æ³•ä»¥ç”Ÿæˆå­äº‹ä»¶.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def inject_bypass_listener(broadcast: Broadcast):
    &#34;&#34;&#34;æ³¨å…¥ BypassListener ä»¥äº«å—å­äº‹ä»¶è§£æ.

    Args:
        broadcast (Broadcast): å¤–éƒ¨äº‹ä»¶ç³»ç»Ÿ, æä¾›äº† event_class_generator æ–¹æ³•ä»¥ç”Ÿæˆå­äº‹ä»¶.
    &#34;&#34;&#34;

    class BypassListener(Listener):
        def __init__(
            self,
            callable: Callable,
            namespace: Namespace,
            listening_events: List[Type[Dispatchable]],
            inline_dispatchers: List[T_Dispatcher] = None,
            decorators: List[Decorator] = None,
            priority: int = 16,
        ) -&gt; None:
            events = []
            for event in listening_events:
                events.append(event)
                events.extend(broadcast.event_class_generator(event))
            super().__init__(
                callable,
                namespace,
                events,
                inline_dispatchers=inline_dispatchers,
                decorators=decorators,
                priority=priority,
            )

    @broadcast.dispatcher_interface.inject_global_raw
    async def _(interface: DispatcherInterface):
        if isinstance(interface.event, interface.annotation):
            return interface.event
        elif (
            hasattr(interface.annotation, &#34;__origin__&#34;)
            and interface.annotation.__origin__ is DispatcherInterface
        ):
            return interface

    import graia.broadcast.entities.listener

    graia.broadcast.entities.listener.Listener = BypassListener  # type: ignore
    graia.broadcast.Listener = BypassListener  # type: ignore
    try:  # Override saya listener
        import graia.saya.builtins.broadcast.schema

        graia.saya.builtins.broadcast.schema.Listener = BypassListener  # type: ignore
    except ImportError:  # Saya not installed, pass.
        pass</code></pre>
</details>
</dd>
<dt id="ariadne.util.inject_loguru_traceback"><code class="name flex">
<span>def <span class="ident">inject_loguru_traceback</span></span>(<span>loop:Â asyncio.events.AbstractEventLoop)</span>
</code></dt>
<dd>
<div class="desc"><p>ä½¿ç”¨ loguru æ¨¡å—æ›¿æ¢é»˜è®¤çš„ traceback.print_exception ä¸ sys.excepthook</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def inject_loguru_traceback(loop: AbstractEventLoop):
    &#34;&#34;&#34;ä½¿ç”¨ loguru æ¨¡å—æ›¿æ¢é»˜è®¤çš„ traceback.print_exception ä¸ sys.excepthook&#34;&#34;&#34;
    traceback.print_exception = loguru_excepthook
    sys.excepthook = loguru_excepthook
    loop.set_exception_handler(loguru_async_handler)</code></pre>
</details>
</dd>
<dt id="ariadne.util.loguru_async_handler"><code class="name flex">
<span>def <span class="ident">loguru_async_handler</span></span>(<span>loop:Â asyncio.events.AbstractEventLoop, ctx:Â dict)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def loguru_async_handler(loop: AbstractEventLoop, ctx: dict):
    if &#34;exception&#34; in ctx:
        logger.opt(exception=ctx[&#34;exception&#34;]).error(&#34;Exception:&#34;)
    else:
        logger.error(f&#34;Exception: {ctx}&#34;)</code></pre>
</details>
</dd>
<dt id="ariadne.util.loguru_excepthook"><code class="name flex">
<span>def <span class="ident">loguru_excepthook</span></span>(<span>cls, val, tb, *_, **__)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def loguru_excepthook(cls, val, tb, *_, **__):
    logger.opt(exception=(cls, val, tb)).error(f&#34;Exception:&#34;)</code></pre>
</details>
</dd>
<dt id="ariadne.util.validate_response"><code class="name flex">
<span>def <span class="ident">validate_response</span></span>(<span>code:Â Union[dict,Â int])</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def validate_response(code: Union[dict, int]):
    origin = code
    if isinstance(code, dict):
        code = code.get(&#34;code&#34;)
    else:
        code = code
    if not isinstance(code, int) or code == 200 or code == 0:
        return
    exc_cls = code_exceptions_mapping.get(code)
    if exc_cls:
        raise exc_cls(exc_cls.__doc__)
    else:
        raise UnknownError(f&#34;{origin}&#34;)</code></pre>
</details>
</dd>
<dt id="ariadne.util.wrap_bracket"><code class="name flex">
<span>def <span class="ident">wrap_bracket</span></span>(<span>string:Â str) â€‘>Â str</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def wrap_bracket(string: str) -&gt; str:
    return string.replace(&#34;[&#34;, &#34;\\u005b&#34;).replace(&#34;]&#34;, &#34;\\u005d&#34;)</code></pre>
</details>
</dd>
<dt id="ariadne.util.yield_with_timeout"><code class="name flex">
<span>async def <span class="ident">yield_with_timeout</span></span>(<span>getter_coro:Â Callable[[],Â Coroutine[None,Â None,Â ~T]], predicate:Â Callable[[],Â bool], await_length:Â floatÂ =Â 0.2) â€‘>Â AsyncIterator[~T]</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">async def yield_with_timeout(
    getter_coro: Callable[[], Coroutine[None, None, T]],
    predicate: Callable[[], bool],
    await_length: float = 0.2,
) -&gt; AsyncIterator[T]:
    last_tsk = None
    while predicate():
        last_tsk = last_tsk or {asyncio.create_task(getter_coro())}
        done, last_tsk = await asyncio.wait(last_tsk, timeout=await_length)
        if not done:
            continue
        for t in done:
            res = await t
            yield res</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="ariadne.util.ApplicationMiddlewareDispatcher"><code class="flex name class">
<span>class <span class="ident">ApplicationMiddlewareDispatcher</span></span>
<span>(</span><span>app)</span>
</code></dt>
<dd>
<div class="desc"><p>æ‰€æœ‰éå•å‡½æ•°å‹ Dispatcher çš„åŸºç±», ç”¨äºä¸ºå‚æ•°è§£ææä¾›å¯æ‰©å±•çš„æ”¯æŒ.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ApplicationMiddlewareDispatcher(BaseDispatcher):
    always = True
    context: ContextManager

    def __init__(self, app) -&gt; None:
        self.app = app

    def beforeExecution(self, interface: &#34;DispatcherInterface&#34;):
        self.context = enter_context(self.app, interface.event)
        self.context.__enter__()

    def afterExecution(self, interface: &#34;DispatcherInterface&#34;, exception, tb):
        self.context.__exit__(exception.__class__ if exception else None, exception, tb)

    async def catch(self, interface: &#34;DispatcherInterface&#34;):
        from ..app import Ariadne

        if interface.annotation is Ariadne:
            return self.app</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>graia.broadcast.entities.dispatcher.BaseDispatcher</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="ariadne.util.ApplicationMiddlewareDispatcher.always"><code class="name">var <span class="ident">always</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="ariadne.util.ApplicationMiddlewareDispatcher.context"><code class="name">var <span class="ident">context</span> :Â ContextManager</code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="ariadne.util.ApplicationMiddlewareDispatcher.afterExecution"><code class="name flex">
<span>def <span class="ident">afterExecution</span></span>(<span>self, interface:Â DispatcherInterface, exception, tb)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def afterExecution(self, interface: &#34;DispatcherInterface&#34;, exception, tb):
    self.context.__exit__(exception.__class__ if exception else None, exception, tb)</code></pre>
</details>
</dd>
<dt id="ariadne.util.ApplicationMiddlewareDispatcher.beforeExecution"><code class="name flex">
<span>def <span class="ident">beforeExecution</span></span>(<span>self, interface:Â DispatcherInterface)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def beforeExecution(self, interface: &#34;DispatcherInterface&#34;):
    self.context = enter_context(self.app, interface.event)
    self.context.__enter__()</code></pre>
</details>
</dd>
<dt id="ariadne.util.ApplicationMiddlewareDispatcher.catch"><code class="name flex">
<span>async def <span class="ident">catch</span></span>(<span>self, interface:Â DispatcherInterface)</span>
</code></dt>
<dd>
<div class="desc"><p>è¯¥æ–¹æ³•å¯ä»¥æ˜¯ <code>staticmethod</code>, <code>classmethod</code> äº¦æˆ–æ˜¯æ™®é€šçš„æ–¹æ³•/å‡½æ•°.
å”¯ä¸€çš„è¦æ±‚æ˜¯ <code>Dispatcher.catch</code> è·å–åˆ°çš„å¿…é¡»ä¸ºä¸€å¯è°ƒç”¨å¼‚æ­¥ Callable.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>interface</code></strong> :&ensp;<code>DispatcherInterface</code></dt>
<dd><code>Dispatcher</code> æœåŠ¡çš„ä¸»è¦å¯¹è±¡, å¯ä»¥ä»å…¶ä¸­è·å–ä»¥ä¸‹ä¿¡æ¯:</dd>
</dl>
<ul>
<li>å½“å‰è§£æä¸­çš„å‚æ•°çš„ä¿¡æ¯;</li>
<li>å½“å‰æ‰§è¡Œçš„ä¿¡æ¯, æ¯”å¦‚æ­£åœ¨å¤„ç†çš„äº‹ä»¶, <code>Listener</code>/<code>ExecTarget</code> etc.;</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">async def catch(self, interface: &#34;DispatcherInterface&#34;):
    from ..app import Ariadne

    if interface.annotation is Ariadne:
        return self.app</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<form>
<input id="lunr-search" name="q" placeholder="ğŸ” Search ..." aria-label="Search"
disabled minlength="2">
</form>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.css" integrity="sha512-j1u8eUJ4f23xPPxwOrLUPQaCD2dwzNqqmDDcWS4deWsMv2ohLqmXXuP3hU7g8TyzbMSakP/mMqoNBYWj8AEIFg==" crossorigin>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.js" integrity="sha512-plGUER9JkeEWPPqQBE4sdLqBoQug5Ap+BCGMc7bJ8BXkm+VVj6QzkpBz5Yv2yPkkq+cqg9IpkBaGCas6uDbW8g==" crossorigin></script>
<style>
.modal-dialog iframe {
width: 100vw;
height: calc(100vh - 80px);
}
@media screen and (min-width: 700px) {
.modal-dialog iframe {
width: 70vw;
height: 80vh;
}
}
.modal-dialog .tingle-modal-box {width: auto;}
.modal-dialog .tingle-modal-box__content {padding: 0;}
</style>
<script>
const input = document.getElementById('lunr-search');
input.disabled = false;
input.form.addEventListener('submit', (ev) => {
ev.preventDefault();
const url = new URL(window.location);
url.searchParams.set('q', input.value);
history.replaceState({}, null, url.toString());
search(input.value);
});
const query = new URL(window.location).searchParams.get('q');
if (query)
search(query);
function search(query) {
const url = '../../doc-search.html#' + encodeURIComponent(query);
new tingle.modal({
cssClass: ['modal-dialog'],
onClose: () => {
const url = new URL(window.location);
url.searchParams.delete('q');
history.replaceState({}, null, url.toString());
setTimeout(() => input.focus(), 100);
}
}).setContent('<iframe src="' + url + '"></iframe>').open();
}
</script>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="ariadne" href="../index.html">ariadne</a></code></li>
</ul>
</li>
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="ariadne.util.async_exec" href="async_exec.html">ariadne.util.async_exec</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="ariadne.util.app_ctx_manager" href="#ariadne.util.app_ctx_manager">app_ctx_manager</a></code></li>
<li><code><a title="ariadne.util.await_predicate" href="#ariadne.util.await_predicate">await_predicate</a></code></li>
<li><code><a title="ariadne.util.cast_to" href="#ariadne.util.cast_to">cast_to</a></code></li>
<li><code><a title="ariadne.util.deprecated" href="#ariadne.util.deprecated">deprecated</a></code></li>
<li><code><a title="ariadne.util.gen_subclass" href="#ariadne.util.gen_subclass">gen_subclass</a></code></li>
<li><code><a title="ariadne.util.inject_bypass_listener" href="#ariadne.util.inject_bypass_listener">inject_bypass_listener</a></code></li>
<li><code><a title="ariadne.util.inject_loguru_traceback" href="#ariadne.util.inject_loguru_traceback">inject_loguru_traceback</a></code></li>
<li><code><a title="ariadne.util.loguru_async_handler" href="#ariadne.util.loguru_async_handler">loguru_async_handler</a></code></li>
<li><code><a title="ariadne.util.loguru_excepthook" href="#ariadne.util.loguru_excepthook">loguru_excepthook</a></code></li>
<li><code><a title="ariadne.util.validate_response" href="#ariadne.util.validate_response">validate_response</a></code></li>
<li><code><a title="ariadne.util.wrap_bracket" href="#ariadne.util.wrap_bracket">wrap_bracket</a></code></li>
<li><code><a title="ariadne.util.yield_with_timeout" href="#ariadne.util.yield_with_timeout">yield_with_timeout</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="ariadne.util.ApplicationMiddlewareDispatcher" href="#ariadne.util.ApplicationMiddlewareDispatcher">ApplicationMiddlewareDispatcher</a></code></h4>
<ul class="">
<li><code><a title="ariadne.util.ApplicationMiddlewareDispatcher.afterExecution" href="#ariadne.util.ApplicationMiddlewareDispatcher.afterExecution">afterExecution</a></code></li>
<li><code><a title="ariadne.util.ApplicationMiddlewareDispatcher.always" href="#ariadne.util.ApplicationMiddlewareDispatcher.always">always</a></code></li>
<li><code><a title="ariadne.util.ApplicationMiddlewareDispatcher.beforeExecution" href="#ariadne.util.ApplicationMiddlewareDispatcher.beforeExecution">beforeExecution</a></code></li>
<li><code><a title="ariadne.util.ApplicationMiddlewareDispatcher.catch" href="#ariadne.util.ApplicationMiddlewareDispatcher.catch">catch</a></code></li>
<li><code><a title="ariadne.util.ApplicationMiddlewareDispatcher.context" href="#ariadne.util.ApplicationMiddlewareDispatcher.context">context</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>